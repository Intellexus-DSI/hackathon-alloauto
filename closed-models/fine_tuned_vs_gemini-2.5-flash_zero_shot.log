================================================================================
VERIFYING DATASETS ARE TAG-FREE
================================================================================
================================================================================
VERIFYING NO TAGS IN DATASETS
================================================================================

Checking Train dataset: ./dataset/annotated-data/train_segments.csv
  ✅ No tags found in tokens
  ✅ No tags found in original_text

Checking Validation dataset: ./dataset/annotated-data/val_segments.csv
  ✅ No tags found in tokens
  ✅ No tags found in original_text

Checking Test dataset: ./dataset/annotated-data/test_segments.csv
  ✅ No tags found in tokens
  ✅ No tags found in original_text

================================================================================
✅ VERIFICATION PASSED: No tags found in any dataset!
================================================================================
Using gemini-2.5-flash for evaluation
Loading test data from: ./dataset/annotated-data/test_segments.csv
Test set size: 83 segments
Total tokens in test set: 26449
Total switches in test set: 223
Average switches per segment: 2.69

Loading Closed Models Predictions from: ./closed-models/results/results_zero_shot_gemini-2.5-flash.jsonl
Loading Fine-tuned Model...
Using device: cpu

Processing all test segments...
Total tokens evaluated: 26449
Ground truth switches: 223
Closed models predicted switches: 199
Fine-tuned predicted switches: 420
Calculating metrics...
====================================================================================================
COMPREHENSIVE EVALUATION RESULTS
====================================================================================================
────────────────────────────────────────────────────────────────────────────────────────────────────
PROXIMITY-BASED METRICS (5-token tolerance)
────────────────────────────────────────────────────────────────────────────────────────────────────
Metric                         gemini-2.5-flash_ZS  ALTO BeRT            Difference          
Precision (w/ tolerance)       0.357                0.450                              +0.093
Recall (w/ tolerance)          0.318                0.848                              +0.529
F1 (w/ tolerance)              0.336                0.588                              +0.251
────────────────────────────────────────────────────────────────────────────────────────────────────
EXACT METRICS (sklearn - no tolerance)
────────────────────────────────────────────────────────────────────────────────────────────────────
Metric                         gemini-2.5-flash_ZS  ALTO BeRT            Difference          
Precision (exact)              0.226                0.450                              +0.224
Recall (exact)                 0.202                0.848                              +0.646
F1 (exact)                     0.213                0.588                              +0.375
F-beta(2) (exact)              0.206                0.720                              +0.514
────────────────────────────────────────────────────────────────────────────────────────────────────
MACRO METRICS (average of switch types)
────────────────────────────────────────────────────────────────────────────────────────────────────
Metric                         gemini-2.5-flash_ZS  ALTO BeRT            Difference          
Macro Precision                0.360                0.476                              +0.117
Macro Recall                   0.322                0.850                              +0.528
Macro F1                       0.340                0.606                              +0.266
Macro F-beta(2)                0.329                0.729                              +0.400
────────────────────────────────────────────────────────────────────────────────────────────────────
PER-TYPE F-BETA(2) SCORES
────────────────────────────────────────────────────────────────────────────────────────────────────
Switch Type                    gemini-2.5-flash_ZS  ALTO BeRT            Difference          
Switch→Auto F-beta(2)          0.388                0.803                              +0.415
Switch→Allo F-beta(2)          0.269                0.655                              +0.386
────────────────────────────────────────────────────────────────────────────────────────────────────
COUNT STATISTICS
────────────────────────────────────────────────────────────────────────────────────────────────────
Statistic                      gemini-2.5-flash_ZS  ALTO BeRT           
True Switches                  223                  223                 
Predicted Switches             199                  420                 
Exact Matches                  43                   182                 
Proximity Matches              28                   7                   
True Switch→Auto               105                  105                 
True Switch→Allo               118                  118                 
Pred Switch→Auto               95                   159                 
Pred Switch→Allo               104                  261                 
====================================================================================================
SUMMARY
====================================================================================================
🏆 Fine-tuned model performs better on key metrics (F1, F-beta scores)
========================================================================================================================
COMPREHENSIVE F-BETA(2) AND PER-CLASS COMPARISON WITH 5-TOKEN TOLERANCE
========================================================================================================================
────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
OVERALL METRICS (5-token tolerance)
────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
Metric               gemini-2.5-flash_ZS       ALTO BeRT                 Difference          
────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
F-beta(2)            0.325                     0.720                                   +0.395
Precision            0.357                     0.450                                   +0.093
Recall               0.318                     0.848                                   +0.529
F1                   0.336                     0.588                                   +0.251
────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
PER-CLASS METRICS: SWITCH→AUTO (with 5-token tolerance)
────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
Metric               gemini-2.5-flash_ZS       ALTO BeRT                 Difference          
────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
F-beta(2)            0.388                     0.803                                   +0.415
Precision            0.421                     0.585                                   +0.164
Recall               0.381                     0.886                                   +0.505
F1                   0.400                     0.705                                   +0.305
Support (count)      105                       105                       (same test set)     
────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
PER-CLASS METRICS: SWITCH→ALLO (with 5-token tolerance)
────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
Metric               gemini-2.5-flash_ZS       ALTO BeRT                 Difference          
────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
F-beta(2)            0.269                     0.655                                   +0.386
Precision            0.298                     0.368                                   +0.070
Recall               0.263                     0.814                                   +0.551
F1                   0.279                     0.507                                   +0.227
Support (count)      118                       118                       (same test set)     


Loading models for detailed segment comparisons...

========================================================================================================================
DETAILED SEGMENT-BY-SEGMENT COMPARISON
========================================================================================================================
────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
SEGMENT 1 | File: S05537E_THEG_PA_CHEN_PO_BLO_SBYONG_GI_GDAMS_PA_Personal_Inst...
Length: 340 tokens | True switches: 2
────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────

Segment Metrics:
  gemini-2.5-flash_ZS - F-beta(2): 0.000 | Precision: 0.000 | Recall: 0.000
  Fine-tuned   - F-beta(2): 0.833 | Precision: 0.500 | Recall: 1.000

Token-by-token comparison (showing first 40 tokens):
────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
Pos   Token        True Label gemini-2.5-flash_ZS  Fine-tuned   Match
────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
[  0] 'dis           Auto         Auto          ✓  Auto     ✓
[  1] thog           Auto         Auto          ✓  Auto     ✓
[  2] ma             Auto         Auto          ✓  Auto     ✓
[  3] med            Auto         Auto          ✓  Auto     ✓
[  4] pa             Auto         Auto          ✓  Auto     ✓
[  5] nas            Auto         Auto          ✓  Auto     ✓
[  6] bdag           Auto         Auto          ✓  Auto     ✓
[  7] skyong         Auto         Auto          ✓  Auto     ✓
[  8] ba'i           Auto         Auto          ✓  Auto     ✓
[  9] phyir          Auto         Auto          ✓  Auto     ✓
[ 10] du             Auto         Auto          ✓  Auto     ✓
[ 11] sgo            Auto         Auto          ✓  Auto     ✓
[ 12] gsum           Auto         Auto          ✓  Auto     ✓
[ 13] sdig           Auto         Auto          ✓  Auto     ✓
[ 14] pa             Auto         Auto          ✓  Auto     ✓
[ 15] mi             Auto         Auto          ✓  Auto     ✓
[ 16] dge            Auto         Auto          ✓  Auto     ✓
[ 17] ba             Auto         Auto          ✓  Auto     ✓
[ 18] sna            Auto         Auto          ✓  Auto     ✓
[ 19] tshogs         Auto         Auto          ✓  Auto     ✓
[ 20] byas           Auto         Auto          ✓  Auto     ✓
[ 21] nas            Auto         Auto          ✓  Auto     ✓
[ 22] da             Auto         Auto          ✓  Auto     ✓
[ 23] lta'i          Auto         Auto          ✓  Auto     ✓
[ 24] bar            Auto         Auto          ✓  Auto     ✓
[ 25] du             Auto         Auto          ✓  Auto     ✓
[ 26] sdug           Auto         Auto          ✓  Auto     ✓
[ 27] bsngal         Auto         Auto          ✓  Auto     ✓
[ 28] myong          Auto         Auto          ✓  Auto     ✓
[ 29] du             Auto         Auto          ✓  Auto     ✓
[ 30] @#             Auto         Auto          ✓  Auto     ✓
[ 31] /              Auto         Auto          ✓  Auto     ✓
[ 32] bcug           Auto         Auto          ✓  Auto     ✓
[ 33] /              Auto         Auto          ✓  Auto     ✓
[ 34] da             Auto         Auto          ✓  Auto     ✓
[ 35] ltar           Auto         Auto          ✓  Auto     ✓
[ 36] yang           Auto         Auto          ✓  Auto     ✓
[ 37] ma             Auto         Auto          ✓  Auto     ✓
[ 38] yin            Auto         Auto          ✓  Auto     ✓
[ 39] pa             Auto         Auto          ✓  Auto     ✓
────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
DETAILED VIEW AT SWITCH POINTS:
────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────

Switch at position 297: →ALLO
Pos      Token           True       gemini-2.5-flash_ZS       Fine-tuned
────────────────────────────────────────────────────────────
    [294] rgyud          Auto             Allo                   Auto      
    [295] las            Auto             Allo                   Auto      
    [296] /              Auto             Allo                   Auto      
>>> [297] stong          →ALLO            Allo                   →ALLO     
    [298] nyid           Allo             Allo                   Allo      
    [299] shes           Allo             Allo                   Allo      
    [300] pa             Allo             Allo                   Allo      

Switch at position 336: →AUTO
Pos      Token           True       gemini-2.5-flash_ZS       Fine-tuned
────────────────────────────────────────────────────────────
    [333] tshugs         Allo             Allo                   Allo      
    [334] so             Allo             Allo                   Allo      
    [335] /              Allo             Allo                   Allo      
>>> [336] zhes           →AUTO            Allo                   →AUTO     
    [337] gsungs         Auto             Allo                   Auto      
    [338] so             Auto             Allo                   Auto      
    [339] /              Auto             Allo                   Auto      
────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
Summary for Segment 1:
  True Labels:    1 →AUTO, 1 →ALLO
  gemini-2.5-flash_ZS:   0 →AUTO, 1 →ALLO
  Fine-tuned:     2 →AUTO, 2 →ALLO
